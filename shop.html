
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Organic GSM – Termékek</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0; padding: 0;
        }
        header {
            background-color: #0f3c73;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            position: relative;
        }
        #logout-button {
            position: absolute;
            right: 20px;
            top: 20px;
            padding: 10px 15px;
            background-color: white;
            color: #0f3c73;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #email-display {
            margin-top: 10px;
            font-size: 16px;
            font-style: italic;
        }
        main {
            display: flex;
            padding: 20px;
        }
        #product-list, #cart {
            width: 50%;
            padding: 10px;
        }
        .product {
            margin: 10px 0;
            padding: 10px;
            background-color: #eef;
            border-radius: 5px;
        }
        .cart-item {
            background-color: #ffe;
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
        }
        button.add-to-cart {
            float: right;
            background-color: #0f3c73;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
        }
        #finalize-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: green;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header>
        Organic GSM – Termékek
        <button id="logout-button" onclick="logout()">Kijelentkezés</button>
        <div id="email-display"></div>
    </header>
    <main>
        <div id="product-list"></div>
        <div>
            <h3>Kosár</h3>
            <div id="cart"></div>
            <button id="finalize-btn" onclick="finalizeOrder()">Rendelés lezárása</button>
        </div>
    </main>

    <script type="module">
        import emailjs from 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
        window.emailjs = emailjs;
        emailjs.init("ll-ox5ToRtPOnL23O");
    </script>

    <script>
        const cart = [];
        const email = localStorage.getItem('loggedInEmail');
        const displayNameMap = {
            "yukonscoutdoo@gmail.com": "Yukon Scout doo",
            "teszt@teszt.hu": "Teszt Felhasználó"
        };
        document.getElementById('email-display').innerText = `Üdvözlünk, ${displayNameMap[email] || email || 'Vendég'}!`;

        function logout() {
            localStorage.removeItem('loggedInEmail');
            window.location.href = 'login.html';
        }

        function renderProducts() {
            const products = [
                { item: "Apple iPhone 14", price: 300 },
                { item: "Samsung Galaxy S23", price: 250 },
                { item: "Xiaomi Redmi Note 12", price: 180 }
            ];
            const container = document.getElementById('product-list');
            container.innerHTML = "<h3>Terméklista</h3>";
            products.forEach((p, idx) => {
                const div = document.createElement("div");
                div.className = "product";
                div.innerHTML = `
                    ${p.item} – ${p.price} EUR
                    <button class="add-to-cart" onclick="addToCart('${p.item}', ${p.price})">Kosárba</button>
                `;
                container.appendChild(div);
            });
        }

        function addToCart(item, price) {
            cart.push({ item, price });
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cart');
            container.innerHTML = "";
            cart.forEach(c => {
                const div = document.createElement("div");
                div.className = "cart-item";
                div.innerText = `${c.item} – ${c.price} EUR`;
                container.appendChild(div);
            });
        }

        function finalizeOrder() {
            if (cart.length === 0) {
                alert("A kosár üres.");
                return;
            }

            const message = cart.map(c => `${c.item} – ${c.price} EUR`).join("\n");

            emailjs.send("service_mq7100r", "template_dkx9ahj", {
                items: message,
                user_email: email
            })
            .then(() => {
                alert("Köszönjük a rendelést!");
            })
            .catch((err) => {
                console.error(err);
                alert("Hiba történt a rendelés küldésekor.");
            });
        }

        window.onload = () => {
            renderProducts();
        };
    </script>
</body>
</html>
